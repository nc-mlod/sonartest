pipeline {
    agent any

    stages {
        stage('Build and Test') {
            steps {
                // Pobierz zależności, skompiluj, wykonaj testy i wygeneruj pliki .exec JaCoCo
                sh 'mvn clean jacoco:prepare-agent install jacoco:report'
            }
        }
    }
    post {
        always {
            script {
                jacoco(execPattern: 'target/jacoco.exec', excludes: '**/controller/**/*.class, **/com/**/*.class')
                archiveArtifacts artifacts: 'target/site/jacoco/**', allowEmptyArchive: true
            }
        }
    }
}